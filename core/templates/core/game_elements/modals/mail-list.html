{% load static %}
{% load customtags %}
{% load i18n %}


{% if received_messages %}
    {% for msg in received_messages %}
    <div data-id="{{ msg.id }}"
        class="mail-item group relative border rounded-xl p-4 cursor-pointer transition
        {% if not msg.is_read and not msg.is_author %}
        border-emerald-400 shadow-[0_0_15px_rgba(16,185,129,0.35)]
        {% else %}
        border-emerald-500/20
        {% endif %}
        bg-zinc-900/60 hover:bg-zinc-900/90 hover:shadow-[0_0_20px_rgba(16,185,129,0.15)]">

        <!-- === Partie 1 : Badge lu / non-lu === -->
        <div class="absolute top-2 right-3 text-xs font-bold tracking-wider">
            {% if not msg.is_read and not msg.is_author %}
            <span class="text-emerald-400 animate-pulse">● NEW</span>
            {% endif %}
        </div>

        <!-- === Partie 2 : Core message section === -->
        <div class="flex items-center gap-4">

            <!-- Avatar + Scan-->
            <div class="relative w-14 min-w-14 h-14">
                <img src='{% static msg.avatar_url %}' alt="{{ msg.name }}" class="w-14 h-14 rounded-lg object-cover border border-emerald-400/50 shadow-lg">
                <!-- Effet glitch -->
                <div class="absolute inset-0 bg-emerald-500/20 mix-blend-screen opacity-30 rounded-lg blur-[1px]"></div>

                <!-- Radar scan (hover) -->
                <div class="absolute inset-0 rounded-lg border border-emerald-400/40 opacity-0 group-hover:opacity-40 animate-radar"></div>
            </div>

            <div class="flex flex-col flex-1 min-w-0">

                <!-- Ligne Auteur + faction + timestamp -->
                <div class="flex items-center gap-1 flex-wrap">

                    <!-- Nom du joueur -->
                    <span class="font-bold text-emerald-200 truncate">
                        {{ msg.name }}
                    </span>

                    <!-- Badge faction coloré -->
                    <span class="tracking-wider {{ msg.faction_color }}">
                        {{ msg.faction }}
                    </span>

                    <!-- Timestamp -->
                    <small class="text-emerald-500/50 italic">
                        {{ msg.timestamp|date:"Y-m-d H:i" }}
                    </small>

                </div>

                <!-- Sujet -->
                <p class="text-sm font-semibold mt-1 text-emerald-100 truncate">
                    {{ msg.subject }}
                </p>

                <!-- Aperçu contenu -->
                <p class="text-emerald-300/60 text-xs line-clamp-1 italic">
                    {{ msg.body|truncatechars:70 }}
                </p>

            </div>
        </div>

        <!-- === Partie 3 : Bouton supprimer === -->
        <div class="flex justify-end pt-3">
            <button class="text-xs text-red-400 hover:text-red-300 font-semibold delete-btn">
                ✖ {% translate "Delete" %}
            </button>
        </div>

    </div>
    {% endfor %}
    <!-- PAGINATION -->
    {% if page_obj %}
    <div id="pagination-controls" class="flex justify-between items-center mt-4 text-emerald-300 text-xs">
        <button id="prev-page" class="px-3 py-1 z-2 border border-emerald-500/40 rounded hover:bg-emerald-500/20 transition disabled:opacity-30 {% if has_previous %}cursor-pointer{% endif %}" {% if not has_previous %}disabled{% endif %}>
            ← {% translate "Previous" %}
        </button>

        <span class="text-emerald-400/70">
            {% translate "Page" %} {{ current_page }} / {{ total_pages }}
        </span>

        <button id="next-page" class="px-3 py-1 z-2 border border-emerald-500/40 rounded hover:bg-emerald-500/20 transition disabled:opacity-30 {% if has_next %}cursor-pointer{% endif %}" {% if not has_next %}disabled{% endif %}>
            {% translate "Next" %} →
        </button>
    </div>
    {% endif %}

{% else %}
    <p class="text-center text-emerald-300/60 py-6 text-sm">
        {% translate "No messages found." %}
    </p>
{% endif %}

