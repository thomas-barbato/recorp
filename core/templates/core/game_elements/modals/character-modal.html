{% load static %}
{% load i18n %}

<div id="character-modal" tabindex="-1" aria-hidden="true" class="hidden fixed inset-0 z-50 flex justify-center items-center w-full h-full backdrop-blur-md bg-black/40">
    <div class="relative md:w-[95vw] w-full md:h-[95vh] h-full max-w-7xl md:max-h-[95vh] md:overflow-hidden overflow-y-auto rounded-xl shadow-lg border border-emerald-800/40 bg-gradient-to-br from-emerald-950/60 via-gray-900/70 to-black/80 flex flex-col">

        <!-- Header -->
        <div class="shrink-0 text-center py-3 border-b border-emerald-700/40 bg-black/40 backdrop-blur-sm">
        <h3 class="text-2xl font-bold font-shadow text-emerald-400 tracking-widest uppercase drop-shadow-md">
            {% translate "Character Sheet" %}
        </h3>
        </div>

        <!-- Contenu principal -->
        <div class="flex-1 flex flex-col lg:flex-row gap-4 p-4 md:overflow-hidden">
        {% for player in map_informations.pc %}
        {% if player.user.player == current_player_id %}
        
        <!-- Colonne gauche : infos joueur (fixe) -->
        <div class="lg:w-1/4 w-full flex flex-col gap-3 bg-gray-900/50 border border-emerald-800/40 rounded-lg shadow-inner p-3 flex-shrink-0">
            <div class="flex justify-center">
            <div class="relative border border-emerald-400/40 rounded-lg md:overflow-hidden shadow-lg shadow-emerald-900/30 hover:scale-105 transition-transform duration-200 cursor-pointer select-none">
                <img id="user-avatar"
                    class="object-cover w-28 h-28 rounded-md select-none"
                    {% if player.user.image %}
                    src="/static/img/users/{{player.user.player}}/0.gif"
                    {% else %}
                    src="{% static 'ux/default-user.svg' %}"
                    {% endif %}>
                <input type="file" id="id_image" class="hidden" name="image" accept=".jpg, .png" />
            </div>
            </div>

            <ul class="text-sm text-emerald-200 font-shadow space-y-1 text-center select-none">
            <li><span class="text-emerald-400 font-bold">{% translate "Name" %}</span>: {{ player.user.name }}</li>
            <li><span class="text-emerald-400 font-bold">{% translate "Archetype" %}</span>: {% translate player.user.archetype_name %}</li>
            <li><span class="text-emerald-400 font-bold">{% translate "Faction" %}</span>: {{ player.faction.name }}</li>
            <li><span class="text-emerald-400 font-bold">{% translate "Sector" %}</span>: {{ player.user.sector_name }}</li>
            </ul>

            <div class="flex flex-col w-full mt-2">
            <div id="editor"
                class="flex w-full h-[30vh] md:overflow-y-auto text-sm bg-gray-800/40 border border-emerald-700/30 rounded-md p-2 text-justify text-emerald-100 font-shadow md:custom-scrollbar">
                {{ player.user.description | safe }}
            </div>
            </div>

            <div class="flex justify-center items-center gap-4 mt-2">
            <i id="edit-mod-btn"
                title="{% translate 'Edit description' %}"
                class="fa-solid fa-file-pen text-2xl p-3 text-emerald-400 hover:text-emerald-300 cursor-pointer hover:scale-110 transition-all"></i>

            <div id="btn-group" class="hidden flex flex-row items-center gap-6">
                <i id="save-edition-btn"
                title="{% translate 'Save changes' %}"
                class="fa-solid fa-floppy-disk text-2xl p-3 text-emerald-400 hover:text-emerald-300 cursor-pointer hover:scale-110 transition-all"></i>
                <i id="cancel-edition-btn"
                title="{% translate 'Discard changes' %}"
                class="fa-solid fa-xmark text-2xl p-3 text-red-500 hover:text-red-400 cursor-pointer hover:scale-110 transition-all"></i>
            </div>
            </div>
        </div>

        <!-- Colonne droite : compétences (scrollable uniquement) -->
        <div class="lg:w-3/4 w-full flex flex-col gap-4 md:overflow-y-auto pr-2 custom-scrollbar skill-scroll">
            {% for category in skills.categories %}
            <fieldset class="flex flex-col w-full fade-in-up bg-gray-900/40 border border-emerald-700/40 rounded-lg shadow-inner p-3 gap-3 select-none">
            <legend class="text-base font-bold text-emerald-300 uppercase tracking-widest bg-emerald-950/60 border border-emerald-700/40 rounded-md px-3 py-1 text-center shadow-sm">
                {% translate category %}
            </legend>

            <div class="flex flex-col gap-3 w-full select-none">
                {% for skill in skills.list %}
                {% if category == skill.cat %}
                <div id="skill-{{ skill.id }}"
                    class="skill-item flex flex-col gap-2 bg-gray-800/50 border border-emerald-700/40 rounded-md p-2 hover:bg-gray-700/40 transition-all duration-200 cursor-pointer relative"
                    data-skill-name="{{ skill.skill_name|escapejs }}"
                    data-skill-level="{{ skill.level }}"
                    data-skill-progress="{{ skill.progress }}"
                    data-skill-description="{{ skill.description|escapejs }}"
                    data-skill-effects="{{ skill.effects|escapejs }}"
                    data-skill-expertise="{{ skill.expertise|escapejs }}">
                <!-- Skill header -->
                <div class="flex justify-between items-center">
                    <p class="text-emerald-300 font-bold text-sm truncate">{% translate skill.skill_name %}</p>
                    <span class="px-2 py-0.5 text-md rounded-md bg-emerald-900 text-emerald-300 border border-emerald-700/40">
                    Lv {{ skill.level }}
                    </span>
                </div>

                <!-- Progress bar -->
                <div class="w-full bg-gray-700/50 rounded-full h-5 relative overflow-hidden border border-emerald-800/30">
                    <div class="absolute top-0 left-0 h-full bg-gradient-to-r from-yellow-500 via-amber-400 to-yellow-300"
                        style="width: {{ skill.progress }}%;"></div>
                    <span class="absolute text-white inset-0 flex justify-center items-center text-md font-bold text-gray-900/80">
                    {{ skill.progress }}%
                    </span>
                </div>

                <!-- Inline detail placeholder (sera créé dynamiquement si nécessaire) -->
                <!-- Ne rien mettre ici statiquement — le JS injectera la div sous la barre -->
                </div>
                {% endif %}
                {% endfor %}
            </div>
            </fieldset>
            {% endfor %}
        </div>
        {% endif %}
        {% endfor %}
        </div>

        <!-- Footer -->
        <div class="shrink-0 border-t border-emerald-800/30 bg-black/40 backdrop-blur-sm flex justify-center items-center py-3">
        <button data-modal-hide="character-modal" type="button"
                class="font-shadow text-emerald-400 font-bold rounded-md border border-emerald-500/50 px-6 py-2.5 hover:text-emerald-200 hover:border-emerald-300 hover:scale-105 transition-all">
            {% translate "Close" %}
        </button>
        </div>

    </div>
</div>